<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>系统调试 | 成长的烦恼</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/font.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">Home</a><a class="sidebar-nav-item" href="/archives">Archives</a></nav><div class="container post-meta"><div class="post-time">2019-01-06</div></div></div><div class="container post-header"><h1>系统调试</h1></div><div class="container post-toc"><details class="toc"><summary class="toc-accordion">Table of Contents</summary><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#cpu指标"><span class="toc-number">1.</span> <span class="toc-text">cpu指标</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#memory指标"><span class="toc-number">2.</span> <span class="toc-text">memory指标</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#调优思路"><span class="toc-number">3.</span> <span class="toc-text">调优思路</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#找到问题"><span class="toc-number">3.1.</span> <span class="toc-text">找到问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#profile工具"><span class="toc-number">3.2.</span> <span class="toc-text">profile工具</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#strace"><span class="toc-number">3.3.</span> <span class="toc-text">strace</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#小结"><span class="toc-number">4.</span> <span class="toc-text">小结</span></a></li></ol></details></div><div class="container post-content"><p>当在本地或服务器上部署服务了以后，我们会希望程序或服务能最大化地利用系统，达到性能最优。要查看程序的性能，最关键的两个指标就是内存占用和cpu占用，拿到了这两个指标，我们再尽可能做程序的优化，或者不能优化的情况下，做一些平衡和取舍。</p>
<h2 id="cpu指标"><a class="header-anchor" href="#cpu指标"></a>cpu指标</h2>
<p>cpu占用情况代表了程序消耗的计算资源，我们可以通过</p>
<ol>
<li>nproc命令，查看机器的cpu个数，</li>
<li><a href="http://man7.org/linux/man-pages/man1/top.1.html" target="_blank" rel="noopener">top</a> 命令，查看机器的负载情况，包括1分钟的load，5分钟的load和15分钟的load，通常如果有8个cpu，那么load在8*1.5=12以内是可以接受的。</li>
</ol>
<h2 id="memory指标"><a class="header-anchor" href="#memory指标"></a>memory指标</h2>
<p>内存占用情况代表了程序消耗的内存资源，我们可以通过</p>
<ol>
<li>free命令，查看当前的内存消耗，包括总的内存，已经使用的内存，还可以使用的内存，cache，swap等，如果剩下的内存较少但是cache很多，还不要紧，后续使用时会从cache里再拿回来，如果剩下内存很少且swap基本占满了，说明程序太吃内存了，这时候就需要优化程序了。</li>
<li>top命令，上面的free是看总的情况，有时候我们一台服务器上跑了很多程序，想看是哪一个占用的多，就可以用top查看。</li>
</ol>
<h2 id="调优思路"><a class="header-anchor" href="#调优思路"></a>调优思路</h2>
<h3 id="找到问题"><a class="header-anchor" href="#找到问题"></a>找到问题</h3>
<p>我们通过查看机器和程序的cpu和内存占用情况，可以很快定位哪个程序，有什么样的缺陷，但现在只是有个粗略的定位，如果想减少cpu消耗或内存消耗，还需要继续深入到程序里去看哪一部分有问题。</p>
<h3 id="profile工具"><a class="header-anchor" href="#profile工具"></a>profile工具</h3>
<p>对python程序，可用的profile工具有自带的profile，line_profiler, memory_profiler
<sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup>等。根据这些工具，我们可以测试每一个函数甚至每一行代码花的时间，占用的内存情况，从而找到问题在哪里。</p>
<h3 id="strace"><a class="header-anchor" href="#strace"></a>strace</h3>
<p>有的时候，程序可能卡在那里而不知道为什么，我们可以通过</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">strace -p PID</span><br></pre></td></tr></table></figure>
<p>查看进程在做什么，具体情况具体分析 <sup class="footnote-ref"><a href="#fn2" id="fnref2">[2]</a></sup>。</p>
<h2 id="小结"><a class="header-anchor" href="#小结"></a>小结</h2>
<p>这篇文章做了一个调试思路的总结，比较宽泛，其实每一个都有很多东西可以深挖，后面继续填坑吧。</p>
<hr class="footnotes-sep">
<section class="footnotes">
<ol class="footnotes-list">
<li id="fn1" class="footnote-item"><p><a href="https://blog.csdn.net/xiemanr/article/details/72763234" target="_blank" rel="noopener">https://blog.csdn.net/xiemanr/article/details/72763234</a> <a href="#fnref1" class="footnote-backref">↩</a></p>
</li>
<li id="fn2" class="footnote-item"><p><a href="https://blog.csdn.net/flyingqr/article/details/70598693" target="_blank" rel="noopener">https://blog.csdn.net/flyingqr/article/details/70598693</a> <a href="#fnref2" class="footnote-backref">↩</a></p>
</li>
</ol>
</section>
</div></div><script type="text/x-mathjax-config">
   MathJax.Hub.Config({"HTML-CSS": { preferredFont: "TeX", availableFonts: ["STIX","TeX"], linebreaks: { automatic:true }, EqnChunk: (MathJax.Hub.Browser.isMobile ? 10 : 50) },
        tex2jax: { inlineMath: [ ["$", "$"], ["\\(","\\)"] ], processEscapes: true, ignoreClass: "tex2jax_ignore|dno",skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']},
        TeX: {  noUndefined: { attributes: { mathcolor: "red", mathbackground: "#FFEEEE", mathsize: "90%" } }, Macros: { href: "{}" } },
        messageStyle: "none"
    }); 
</script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>
<script type="text/javascript" src="https://cdn.bootcss.com/mathjax/2.7.2/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><div class="post-main post-comment"></div></article><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script></body></html>